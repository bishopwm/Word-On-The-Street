<div class="hero-unit">
	<div class="hero-hugs">
	</div>
</div>

<hr />

<div class="container why-section">
<h1> What's the Word on the Street<br />...and why do I care?</h1>
<h3>Word on the Street is an online resource that receives a user's geolocation in order to map out all of the 'happenings' in their international community! It's all about accessibility. Get the 'gist' of whatever is going on in your neighborhood or city at a moment's notice: tweets, instagrams, businesses, restaurants, and meetups. Whether you're an expat, a traveller, or just someone curious about the exciting things going on in your neighborhood, don't forget to checkout the Word on the Street before your next outing.</h3>
<hr />

<ul class="logo-list">
	<li class="logo-list-item"><img src="/assets/square-yelp.png" width="50px"></li>
	<li class="logo-list-item"><img src="/assets/insta.png" width="70px"></li>
	<li class="logo-list-item"><img src="/assets/twitter.png" width="50px"></li>
	<li class="logo-list-item"><img src="/assets/square-meetup.png" width="50px"></li>
</ul>
<hr />
<div class = "well new-search">
<form>
  <div class="form-group">
    <label for="new-search">New Search</label>
    <input type="text" class="form-control" name="q" id="new-search" placeholder="Enter Nationality">
    <input type="hidden" class="form-control" name="latitude" id="lat">
    <input type="hidden" class="form-control" name="longitude" id="lon">
  </div>
  <button type="submit" class="btn btn-default">Submit</button>
</form>

</div>


</div>

	<div class="well insta-bar">
		<ul class="instas-list"><img src="/assets/insta-word.png" width="160px" class="insta-word"><br /><br />
			<% @instas.each do |insta| %>
			<li class="insta-list-item">
				<img src="<%= insta['image']['url'] %>" class="insta-pic">
			</li>
			<li class="insta-list-item">
				<%= insta['location_name'] %>
			</li><br />
			
				<% end %>
		</ul>
	</div>
	<div class="well twitter-bar">
		<ul class="tweets-list"><img src="/assets/twitter-word.png" width="160px" class="twitter-word"><br /><br />
			<% @tweets.each do |tweet_hash| %>
			<li class="twitter-list-item">
				<img src="/assets/twitter.png" width="30px">
				<%= tweet_hash[:tweet] %>
			</li>
			<hr />
			<br />			
			<% end %>
		<ul>
	</div>
		<div id="map"></div>
	</div>

<script type="text/javascript">

	$(function () {
		$('#lat').val(localStorage.getItem('latitude'));
		$('#lon').val(localStorage.getItem('longitude'));
		
		var map = L.map('map').setView([<%= @latitude %>, <%= @longitude %>], 14);
		var currentLocation = [<%= @latitude %>, <%= @longitude %>];


		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={access_token}', {
		    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		    maxZoom: 18,
		    id: "<%= ENV['mapbox_id'] %>",
		    access_token: "<%= ENV['mapbox_access_token'] %>"
		}).addTo(map);	

		map.scrollWheelZoom.disable();

		var markersYelp = {}
		var markersMeetup = {}
		var markersInsta = {}

		var currentLocationIcon = L.icon({
		    iconUrl: '/assets/star.png',
		    iconSize: [40, 50],
		    iconAnchor: [22, 64],
		    popupAnchor: [-3, -76]	
		});
		var currentLocationMarker = L.marker(currentLocation, {icon: currentLocationIcon}).addTo(map);
		var currentLocationContent = '<h4>You Are Here</h4>'
		currentLocationMarker.bindPopup(currentLocationContent);

		var meetupIcon = L.icon({
		    iconUrl: '/assets/Meetup_Logo.png',
		    iconSize: [55, 40],
		    iconAnchor: [22, 64],
		    popupAnchor: [-3, -76]
		});

		var yelpIcon = L.icon({
			iconUrl: '/assets/Yelp_Logo.png',
			iconSize: [55, 40],
		    iconAnchor: [22, 64],
		    popupAnchor: [-3, -76]			
		});
		var instaIcon = L.icon({
			iconUrl: '/assets/insta.png',
			iconSize: [45, 30],
		    iconAnchor: [22, 64],
		    popupAnchor: [-3, -76]			
		});


		//Yelp Content
		var popupContentsYelp = {}



		<% @businesses.each_with_index do |business, index| %>
			<% if current_user %>
				popupContentsYelp["popup" + <%= index %>] = "<h3><%= escape_javascript business[:name].to_s %></h3><p><strong>Address: </strong><%=escape_javascript business[:address].to_s.gsub!(/\W/,' ') %></p><p><strong>Website </strong><br /><a href='<%= business[:url].to_s.html_safe %>' target='_blank'>Visit Business Page</a></p><p><strong>Rating </strong><br /><%=escape_javascript business[:rating].to_s %></p><p><strong>Distance from me: </strong><br /><%=escape_javascript business[:distance].to_s %><strong> meters</strong></p><p><form method='POST' action='/streetwords'><input type='hidden' name='authenticity_token' value='<%= form_authenticity_token %>'><input type='hidden' value='<%= business[:name] %>' name='streetword[name]'><input type='hidden' value='<%= business[:latitude] %>' name='streetword[latitude]' ><input type='hidden' value='<%= business[:longitude] %>' name='streetword[longitude]'><input type='hidden' value='<%= business[:address] %>' name='streetword[address]'><button type='submit' class='btn btn-default'>Save</button></form></p>"
			<% else %>
				popupContentsYelp["popup" + <%= index %>] = "<h3><%= escape_javascript business[:name].to_s %></h3><p><strong>Address: </strong><%=escape_javascript business[:address].to_s.gsub!(/\W/,' ') %></p><p><strong>Website </strong><br /><a href='<%= business[:url].to_s.html_safe %>' target='_blank'>Visit Business Page</a></p><p><strong>Rating </strong><br /><%=escape_javascript business[:rating].to_s %></p><p><strong>Distance from me: </strong><br /><%=escape_javascript business[:distance].to_s %><strong> meters</strong></p>"
			<% end %>
			markersYelp["marker" + <%= index %>] = L.marker(<%= business[:coordinates] %>, {icon: yelpIcon}).bindPopup(popupContentsYelp['popup' + <%= index %>]).addTo(map);
		<% end %>


	
		//Meetup Content
		var popupContentsMeetup = {}

		<% @meetups.each_with_index do |meetup, index| %>
			<% if current_user %>
			popupContentsMeetup["popup" + <%= index %>] = "<h3><%=escape_javascript meetup['event'] %></h3><p><strong>Address: </strong><br /><%= escape_javascript meetup['address'] %></p><p><%= escape_javascript meetup['venue'] %></p><p><strong>Who is this for?</strong><br /><%= escape_javascript meetup['who'].to_s %></p><p><strong>Website </strong><br /><a href='<%= meetup['url'].to_s.html_safe %>' target='_blank'>Visit Event Page</a></p><p><form method='POST' action='/streetwords'><input type='hidden' name='authenticity_token' value='<%= form_authenticity_token %>'><input type='hidden' value='<%= meetup['event'] %>' name='streetword[name]'><input type='hidden' value='<%= meetup['coordinates'][0] %>' name='streetword[latitude]' ><input type='hidden' value='<%= meetup['coordinates'][1] %>' name='streetword[longitude]'><input type='hidden' value='<%= meetup['address'] %>' name='streetword[address]'><button type='submit' class='btn btn-default'>Save</button></form></p>"
			<% else %>
				popupContentsMeetup["popup" + <%= index %>] = "<h3><%=escape_javascript meetup['event'] %></h3><p><strong>Address: </strong><br /><%= escape_javascript meetup['address'] %></p><p><%= escape_javascript meetup['venue'] %></p><p><strong>Who is this for?</strong><br /><%= escape_javascript meetup['who'].to_s %></p><p><strong>Website </strong><br /><a href='<%= meetup['url'].to_s.html_safe %>' target='_blank'>Visit Event Page</a></p>"
			<% end %>
			markersMeetup["marker" + <%= index %>] = L.marker(<%= meetup["coordinates"] %>, {icon: meetupIcon}).bindPopup(popupContentsMeetup['popup' + <%= index %>]).addTo(map);
		<% end %>

		//Insta Content
		var popupContentsInsta = {}

		<% @instas.each_with_index do |insta, index| %>
			var popupString = "<p><img width='50px' src='<%=escape_javascript insta['image']['url']%>'class='instapopup'></p>"
			<% if insta['hashtag'].length > 0 %>
				popupString += "<p>Hashtags: <%=escape_javascript insta['hashtag'].to_s.gsub!(/\W/,' ') %></p>"
			<% end %>
			<% if insta['location_name'] %>
				popupString += "<p>Location: <%=escape_javascript insta['location_name'] %></p>"
			<% end %>
			popupContentsInsta["popup" + <%= index %>] = popupString
			markersInsta["marker" + <%= index %>] = L.marker(<%= insta["coordinates"] %>, {icon: instaIcon}).bindPopup(popupContentsInsta['popup' + <%= index %>], {minWidth: 100}).addTo(map);
		<% end %>


		function goTo($el) {
		    $('html, body').animate({
		        scrollTop: $el.offset().top + 'px'
		    }, 'slow');
		    return $el;
	    }

	    goTo($('#map'));

	})

</script>
